# [AHC038](https://atcoder.jp/contests/ahc038/)

## 問題理解

- 入力
  - N: グリッドの大きさ。15-30でランダムに決定
  - M: たこ焼きの個数。N^2/10-N^/2(23-450)でランダムに決定
  - V: ロボットアームの頂点数。5-15でランダムに決定
  - s: たこ焼きの初期状態
  - t: たこ焼きの目的地
    - s, tは1-5個の中心を決定し、それぞれ独立に標準偏差2-5ガウス分布を、重み0-1で重ね合わせた分布。つまり、いくつかの中心に集まって配置されいている
- 出力
  - V': 使うロボットアームの頂点の個数
  - p: 頂点の親
  - L(p, u): 親p-子uのアームの長さ
  - (x, y): 頂点0の初期位置
    - 初期状態では、すべての子は、右向きになっている
  - S: 操作列
    - 1文字目: UDLRで頂点0の上下左右の1マス移動
    - 2文字目からV'文字目: 親を中心に、L反時計周り、R時計回りに90度回転、.は何もしない
    - V'+1文字目からV'+V'文字目: 親は.、子はPでたこ焼きを掴むか離す、.は何もしない
- スコア
  - すべてのたこ焼きを目的地に配置するとターン数K
  - ターン数を最小にする
- ターン
  - 以下のアームの操作を繰り返す
    - 頂点0は上下左右に移動
    - 他の頂点は親を中心に時計回りか反時計回りに90度回転
    - 葉(アームの先)はたこ焼きを掴むか離すか何もしない

## 考察

- たこ焼きや目的地は固まっているため、まとめて処理した方が効率がよい
- ロボットアームは、V頂点で長さ1にすると頂点0から対角線2Vのひし形にアームが到達できる
  - アームの頂点2つを使って折りたたむと2V-2のひし形も実現できる。その後2つずつ折りたたむひし形を実現できる
  - 到達できる点から、別の点に切り替える時、多くとも2ターンで到達できる
- 目標ターン数
  - アームが範囲Vで自由に動ける1本があるとする
  - M個のたこ焼きを、M個の場所に移動するとする
  - 固まっているため端から順に処理して、少しずつ移動すれば、掴む離すのターン数のみと考えられる
  - 掴むのに2ターン、離すのに2ターンかかるため4Mターン
  - Vが5-15のため、VがN/2程度なら上記を実現可能だが、それより小さい場合は移動にターン数がかかる。親と子のアームの長さを2などにのばすと解決する可能性がある
- 初期解
  - アームの頂点数V、すべての長さ1で、端から処理をしていき4Mターンを目指す
- 今後の改善案
  - アームの親と子の長さを2など長くすると、移動のターン数を節約できる可能性があるが、アームの可動域は狭くなる
  - アームの親と子の長さを変えることも含めて、アームの本数を増やせる可能性がある。2本にすれば単純計算で1/2になる
  - アームの葉だけを分岐すると比較的操作しやすく、一気に移動できるかも。MがN^2/2の場合は、単純にはマップの半分がたこ焼き、半分が目的地で密になってそう。ただし半分までは重なりがあり得る。たこ焼き屋さんがやっているように、横並びいくつかを一気に別の場所に移動する感じができそう
- アームの動作
  - 根の方向は、次の動作にも影響を与えるので、重要
  - 基本的には、URLの回転で目的地に到着できれば、次の目的地も同じようにURLの組み合わせで実現できる気がする
  - ひし形の頂点から、対角線上の逆の頂点に向かう場合は、2ターンかかる(少なくとも根で2ターン)
  - アームの葉を目的地に移動するには、以下の処理を行う
    - 根の移動: アームの最大長より遠い、アームの最大長と目的地の差分が2の倍数でない、根と目的地が一致している、場合は移動する
    - ノードの決定: 目的地に近づくように方向を選択、ただしアームの最大長と目的地の差分がある場合は目的地に遠ざかるようにする、選択にあたってはまっすぐの0を優先、戻ってくる2を優先度を下げる
- アームの構造
  - 根: (x, y)
  - ノード: 親に対する相対角度
- たこ焼きの選択
  - たこ焼きの密度が高いところから、目的地の密度が高い方に移動しながら処理をする。たこ焼きの密度が高い側の一番端から順に処理をする
  - 初期位置の重心から、目的地の重心に向かうように処理をする
  - 中心からみて、初期位置の重心の方向の一番端のたこ焼きから処理をする

## 日記

### 20241005

考察をして、まずは1本のアームで4Mターンを目指そうと思った
何もせずに提出するとサンプル200ケースで、スコア40Mになりそう。それが順位表で並んでいる24,125,245かな？
4Mターンですべて目的地に配置できたとすると112Kになりそう。すると約400倍、スコア10Mぐらいになりそう？それで24位
トップは20M(1位は48Mだけど。。。)倍の効率で実施している
たこ焼きを掴んで離すは1回4ターンで見ているけど、多くは2ターンでできると思うので、1本のアームで処理順を最適にすれば、いけそうなスコア？
まあ1本のアームで4Mターンを実装するのが難しいのだけど。。。多分アームの動き、たこ焼きと目的地の選択、最後の方に残ったたこ焼き、結構移動が必要など、4Mにするのも難しいと思う。。。
でもたこ焼き掴んで離す2ターンが最小だから、2Mターンが最適なのか、と考えると1位の人はすでに最適解に近い！？ただすでに目的地にあるたこ焼きもあるから、その分2Mターンより小さくもなるな
でも2Mターンが最適は、1本のアームの場合だ、アームの数を増やすことっも可能だから、2本でMターン、3本で2/3Mターン、4本で1/2Mターンなどもあるな
上位陣は最終的に4Mターンの数倍の改善を行ってくるんだろうな。それでも1/2～1Mターンぐらいが限界かな？
とりあえず初期考察としては、結構いいと思うので、まずは初期解を実装しよう。初期解の実装に1週間ぐらいかかったりするのだけど。。。
情報処理技術者試験の勉強もあるのだけど、AHCも頑張りたい

### 20241006

昨日は日中はあまりできず、夜はABCに参加
ただアームの動きの実装が難しい
やはりうまく動きを決めると、ほぼ1ターンで所定の目的地に着ける気がする

日曜なのに余り取り組めず。。。
何とかアームが動くようになってきた
アームの動きより、どのたこ焼きをどこに置くかが最適化で重要だと思った
以下の考察により、今回の問題がたこ焼き屋さんに見えてきた。でも密な場合には有用そう
アームの葉だけを分岐すると比較的操作しやすく、一気に移動できるかも。MがN^2/2の場合は、単純にはマップの半分がたこ焼き、半分が目的地で密になってそう。ただし半分までは重なりがあり得る。たこ焼き屋さんがやっているように、横並びいくつかを一気に別の場所に移動する感じができそう

### 20241007

アームの動きが何となくできてきたけど、うまく動かない場合がよくある。スタートラインに立てない。。。
根は枠外に出れないのね。やはりアームは最大長だけで実装したけど、曲げられるようにしないとダメだな。。。
めっちゃ苦戦して、やっとアームの動作がちゃんと動くようになった！

## ToDo

- アームの頂点数V、すべての長さ1で、端から処理をしていき4Mターンを目指す
  - アームの可動域を特定する
  - アームをある点からある点に移動する
  - 掴むたこ焼きと目的地を決める
  - スコア計算

## History

- v1: アームの頂点数V、すべての長さ1で、端から処理をしていき4Mターンを目指す(スコア: 54,608, 予測: 40,752)

## 実行コマンド

- 1テストケース実行

```
cargo build
cat .\in\0000.txt | .\target\debug\ahc038.exe > .\out\0000.txt
```

- 一括実行

```
cargo build
python .\simulator.py
```
